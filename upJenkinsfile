def branch_to_build
pipeline {
    agent  {
        label 'master'
    }
  
    stages {
         stage('scm') {
            steps {
             dir("$WORKSPACE/ernx") {
                 git branch: '**', url:  'https://github.com/einavle/earnix-task'
               //  sh 'printenv'
               script{
               println "the branch to build is "+ "git rev-parse --abbrev-ref HEAD".execute().text
                 branch_to_build="git rev-parse --abbrev-ref HEAD".execute().text
                 echo " the branch to build is $branch_to_build"
                 }
                 }
                
            }
        }
        stage('downstream') {
            steps {
                 build job: "builder", parameters: [
                    [$class: 'StringParameterValue', name: 'branch_to_build', value: "${branch_to_build}"]
                    ]
                
            }
        }

    }
}

 
