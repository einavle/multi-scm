def branch_to_build
pipeline {
    agent  {
        label 'master'
    }
  
    stages {
         stage('scm') {
            steps {
             dir("$WORKSPACE/ernx") {
                 git branch: '**', url:  'https://github.com/einavle/earnix-task'
                 sh """
                 branch_to_build=\$(git rev-parse --abbrev-ref HEAD)
                 echo \$branch_to_build
                 """
                 println "the branch to build is "+ "git rev-parse --abbrev-ref HEAD".execute().text 
               //  sh 'printenv'
              
                
                 }
                
            }
        }
        stage('downstream') {
            steps {
            dir("$WORKSPACE/ernx") {
            echo "in downstream"
                echo "$branch_to_build"
                
                // build job: "builder", parameters: [
                //    [$class: 'StringParameterValue', name: 'branch_to_build', value: "${branch_to_build}"]
                //    ]
                    }
                
            }
        }

    }
}

 
